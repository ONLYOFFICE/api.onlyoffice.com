# Lock

`POST /wopi/files/(file_id)`

锁定文件以供请求 [lock](../key-concepts.md#lock) 的 WOPI 客户端应用程序实例编辑。

此操作的工作原理如下：

1. WOPI 主机检查文件当前是否被锁定。
2. 如果文件**未被锁定**，主机应该锁定文件并返回 **200 OK**。
3. 如果文件已经**被锁定**并且 **X-WOPI-Lock** 值与文件当前的锁定匹配，主机应该刷新锁定计时器并返回 **200 OK**。
4. 在所有其他情况下，主机必须返回 **409 Conflict** (*"lock mismatch"*) 并包含 **X-WOPI-Lock** 响应标头，标头中包含文件当前锁的值。
5. 在文件被第三方客户端锁定的情况下，主机仍应始终在 **X-WOPI-Lock** 响应标头中包含当前锁 ID。

## 参数

| 名称     | 类型   | 描述                                                                 |
| -------- | ------ | --------------------------------------------------------------------------- |
| file\_id | string | [file ID](../key-concepts.md#file-id) 必须是 URL 安全的文件 ID。 |

## 查询参数

| 名称          | 类型   | 描述                                                                                                                          |
| ------------- | ------ | ------------------------------------------------------------------------------------------------------------------------------------ |
| access\_token | string | [访问令牌](../key-concepts.md#access-token) 主机将用它确定请求是否被授权。 |

## 请求标头

| 名称            | 类型   | 出现 | 描述                                                          |
| --------------- | ------ | -------- | -------------------------------------------------------------------- |
| X-WOPI-Override | string | 必需的 | 来自 WOPI 服务器的请求操作 (*LOCK*)。               |
| X-WOPI-Lock     | string | 必需的 | 锁ID主机必须用它来标识文件上的锁。 |

## 响应标头

| 名称                     | 类型   | 出现 | 描述                                                                                                                                                                                                               |
| ------------------------ | ------ | -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| X-WOPI-Lock              | string | 可选的 | 锁ID标识文件上的当前锁。当使用 **409 Conflict**响应请求时，必须始终包含此标头。用 **200 OK**响应请求时不应包含它。 |
| X-WOPI-LockFailureReason | string | 可选的 | 锁定失败的原因。当使用 **409 Conflict**响应请求时，可能会包含此标头。它只能用于记录目的。                                                               |
| X-WOPI-ItemVersion       | string | 可选的 | 文件版本。                                                                                                                                                                                                         |
